webpackJsonp([2],{777:function(n,l,e){"use strict";function t(n){return s._22(0,[s._14(0,Z.e,[s.r]),(n()(),s.Z(1,0,null,null,10,"div",[["class","text"]],null,null,null,null,null)),s.Y(2,278528,null,0,Z.i,[s.p,s.q,s.j,s.A],{klass:[0,"klass"],ngClass:[1,"ngClass"]},null),s._15(3,{"sender-background":0}),(n()(),s._20(-1,null,["\n  "])),(n()(),s.Z(5,0,null,null,1,"P",[],null,null,null,null,null)),(n()(),s._20(6,null,["",""])),(n()(),s._20(-1,null,["\n  "])),(n()(),s.Z(8,0,null,null,2,"p",[["class","timestamp"]],null,null,null,null,null)),(n()(),s._20(9,null,["",""])),s._16(10,2),(n()(),s._20(-1,null,["\n"]))],function(n,l){n(l,2,0,"text",n(l,3,0,l.component.isFromSender))},function(n,l){var e=l.component;n(l,6,0,e.message.text);n(l,9,0,s._21(l,9,0,n(l,10,0,s._13(l,0),e.message.timestamp,"dd/MM/y H:mm")))})}function u(n){return s._22(0,[(n()(),s.Z(0,0,null,null,1,"message-box",[],[[4,"justify-content",null],[4,"text-align",null]],null,null,t,$)),s.Y(1,49152,null,0,w.a,[],{message:[0,"message"],isFromSender:[1,"isFromSender"]},null)],function(n,l){n(l,1,0,l.context.$implicit,l.context.$implicit.userId===l.component.sender.$key)},function(n,l){n(l,0,0,s._13(l,1).isFromSender?"flex-end":"flex-start",s._13(l,1).isFromSender?"right":"left")})}function a(n){return s._22(0,[s._18(402653184,1,{content:0}),(n()(),s.Z(1,0,null,null,5,"ion-header",[],null,null,null,null,null)),s.Y(2,16384,null,0,x.a,[P.a,s.j,s.z,[2,F.a]],null,null),(n()(),s._20(-1,null,["\n\n  "])),(n()(),s.Z(4,0,null,null,1,"custom-logged-header",[],null,null,null,T.b,T.a)),s.Y(5,114688,null,0,z.a,[V.a,r.a,D.a,I.a],{title:[0,"title"],user:[1,"user"]},null),(n()(),s._20(-1,null,["\n\n"])),(n()(),s._20(-1,null,["\n\n\n"])),(n()(),s.Z(8,0,null,null,7,"ion-content",[["padding",""]],[[2,"statusbar-padding",null],[2,"has-refresher",null]],null,null,O.b,O.a)),s.Y(9,4374528,[[1,4]],0,U.a,[P.a,B.a,L.a,s.j,s.z,D.a,A.a,s.u,[2,F.a],[2,E.a]],null,null),(n()(),s._20(-1,1,["\n\n  "])),(n()(),s._20(-1,1,["\n\n  "])),(n()(),s.U(16777216,null,1,2,null,u)),s.Y(13,802816,null,0,Z.j,[s.I,s.F,s.p],{ngForOf:[0,"ngForOf"]},null),s._14(131072,Z.b,[s.g]),(n()(),s._20(-1,1,["\n\n"])),(n()(),s._20(-1,null,["\n\n"])),(n()(),s.Z(17,0,null,null,27,"ion-footer",[],null,null,null,null,null)),s.Y(18,16384,null,0,K.a,[P.a,s.j,s.z,[2,F.a]],null,null),(n()(),s._20(-1,null,["\n  "])),(n()(),s.Z(20,0,null,null,23,"ion-toolbar",[["class","toolbar"]],[[2,"statusbar-padding",null]],null,null,X.b,X.a)),s.Y(21,49152,null,0,q.a,[P.a,s.j,s.z],null,null),(n()(),s._20(-1,3,["\n    "])),(n()(),s.Z(23,0,null,3,19,"ion-item",[["class","item item-block"],["no-lines",""]],null,null,null,H.b,H.a)),s.Y(24,1097728,null,3,J.a,[N.a,P.a,s.j,s.z,[2,R.a]],null,null),s._18(335544320,2,{contentLabel:0}),s._18(603979776,3,{_buttons:1}),s._18(603979776,4,{_icons:1}),s.Y(28,16384,null,0,W.a,[],null,null),(n()(),s._20(-1,2,["\n      "])),(n()(),s.Z(30,0,null,3,4,"ion-input",[["placeholder","Message..."],["type","text"]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"keyup.enter"],[null,"ngModelChange"]],function(n,l,e){var t=!0,u=n.component;if("keyup.enter"===l){u.sendMessage(u.newMessage);t=!1!==(u.newMessage="")&&t}if("ngModelChange"===l){t=!1!==(u.newMessage=e)&&t}return t},G.b,G.a)),s.Y(31,671744,null,0,Q.n,[[8,null],[8,null],[8,null],[8,null]],{model:[0,"model"]},{update:"ngModelChange"}),s._17(2048,null,Q.j,null,[Q.n]),s.Y(33,16384,null,0,Q.k,[Q.j],null,null),s.Y(34,5423104,null,0,nn.a,[P.a,B.a,N.a,D.a,s.j,s.z,[2,U.a],[2,J.a],[2,Q.j],L.a],{type:[0,"type"],placeholder:[1,"placeholder"]},null),(n()(),s._20(-1,2,["\n      "])),(n()(),s.Z(36,0,null,4,5,"button",[["ion-button",""],["item-right",""]],null,[[null,"click"]],function(n,l,e){var t=!0,u=n.component;if("click"===l){u.sendMessage(u.newMessage);t=!1!==(u.newMessage="")&&t}return t},ln.b,ln.a)),s.Y(37,1097728,[[3,4]],0,en.a,[[8,""],P.a,s.j,s.z],null,null),(n()(),s._20(-1,0,["\n        "])),(n()(),s.Z(39,0,null,0,1,"ion-icon",[["name","send"],["role","img"]],[[2,"hide",null]],null,null,null,null)),s.Y(40,147456,null,0,tn.a,[P.a,s.j,s.z],{name:[0,"name"]},null),(n()(),s._20(-1,0,["\n      "])),(n()(),s._20(-1,2,["\n    "])),(n()(),s._20(-1,3,["\n  "])),(n()(),s._20(-1,null,["\n"]))],function(n,l){var e=l.component;n(l,5,0,e.pageTitle,e.recipient);n(l,13,0,s._21(l,13,0,s._13(l,14).transform(e.viewMessages)));n(l,31,0,e.newMessage);n(l,34,0,"text","Message...");n(l,40,0,"send")},function(n,l){n(l,8,0,s._13(l,9).statusbarPadding,s._13(l,9)._hasRefresher);n(l,20,0,s._13(l,21)._sbPadding);n(l,30,0,s._13(l,33).ngClassUntouched,s._13(l,33).ngClassTouched,s._13(l,33).ngClassPristine,s._13(l,33).ngClassDirty,s._13(l,33).ngClassValid,s._13(l,33).ngClassInvalid,s._13(l,33).ngClassPending);n(l,39,0,s._13(l,40)._hidden)})}Object.defineProperty(l,"__esModule",{value:!0});var s=e(0),i=(e(2),e(220)),r=(e(60),e(37)),o=e(100),c=e(223),g=e(67),d=e(440),_=e(439),p=e.n(_),h=function(){function n(n,l,e,t,u,a){this.authService=n,this.navCtrl=l,this.navParams=e,this.chatService=t,this.messageService=u,this.userService=a}return n.prototype.ionViewCanEnter=function(){return this.authService.authenticated},n.prototype.ionViewDidLoad=function(){var n=this;this.recipient=this.navParams.get("recipientUser"),this.pageTitle=this.recipient.name,this.userService.mapObjectKey(this.userService.currentUser).first().subscribe(function(l){n.sender=l,n.chat1=n.chatService.getDeepChat(n.sender.$key,n.recipient.$key),n.chat2=n.chatService.getDeepChat(n.recipient.$key,n.sender.$key),n.recipient.photo&&n.chat1.valueChanges().first().subscribe(function(l){n.chatService.updatePhoto(n.chat1,l.photo,n.recipient.photo)});var e=function(){n.viewMessages=n.messageService.mapListKeys(n.messages),n.viewMessages.subscribe(function(l){n.scrollToBottom()})};n.messages=n.messageService.getMessages(n.sender.$key,n.recipient.$key),n.messages.valueChanges().first().subscribe(function(l){0===l.length?(n.messages=n.messageService.getMessages(n.recipient.$key,n.sender.$key),e()):e()})})},n.prototype.sendMessage=function(n){var l=this;if(n){var e=p.a.database.ServerValue.TIMESTAMP;this.messageService.create(new d.a(this.sender.$key,n,e),this.messages).then(function(){l.chat1.update({lastMessage:n,timestamp:e}),l.chat2.update({lastMessage:n,timestamp:e})})}},n.prototype.scrollToBottom=function(n){var l=this;setTimeout(function(){l.content&&l.content.scrollToBottom(n||300)},50)},n}(),m=e(221),f=function(){return function(){}}(),v=e(426),b=e(427),y=e(428),M=e(429),S=e(430),k=e(431),C=e(432),j=e(433),Y=e(434),Z=e(18),w=e(436),$=s.X({encapsulation:2,styles:[],data:{}}),x=e(99),P=e(4),F=e(8),T=e(438),z=e(147),V=e(49),D=e(11),I=e(35),O=e(146),U=e(32),B=e(7),L=e(14),A=e(38),E=e(27),K=e(227),X=e(441),q=e(47),H=e(72),J=e(23),N=e(21),R=e(46),W=e(61),G=e(435),Q=e(22),nn=e(98),ln=e(41),en=e(25),tn=e(40),un=e(19),an=s.X({encapsulation:2,styles:[],data:{}}),sn=s.V("page-chat",h,function(n){return s._22(0,[(n()(),s.Z(0,0,null,null,1,"page-chat",[],null,null,null,a,an)),s.Y(1,49152,null,0,h,[r.a,E.a,un.a,o.a,c.a,g.a],null,null)],null,null)},{},{},[]),rn=e(222),on=e(68);e.d(l,"ChatPageModuleNgFactory",function(){return cn});var cn=s.W(f,[],function(n){return s._10([s._11(512,s.i,s.S,[[8,[v.a,b.a,y.a,M.a,S.a,k.a,C.a,j.a,Y.a,sn]],[3,s.i],s.s]),s._11(4608,Z.m,Z.l,[s.r,[2,Z.u]]),s._11(4608,Q.t,Q.t,[]),s._11(4608,Q.d,Q.d,[]),s._11(512,Z.c,Z.c,[]),s._11(512,Q.r,Q.r,[]),s._11(512,Q.g,Q.g,[]),s._11(512,Q.o,Q.o,[]),s._11(512,rn.a,rn.a,[]),s._11(512,rn.b,rn.b,[]),s._11(512,i.a,i.a,[]),s._11(512,m.a,m.a,[]),s._11(512,f,f,[]),s._11(256,on.a,h,[])])})}});